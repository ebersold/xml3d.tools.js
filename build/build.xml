<?xml version="1.0" encoding="UTF-8"?>
<!-- ======================================================================
     project    xml3d.js
     description
     Deploy script that prepares a single xml3d.js script file

     Author: Kristian Sons
     ====================================================================== -->
<project name="script-merge" default="develop">
	<description>
           Merge all the single scripts to one global xml3d-motion.js
    </description>

    <import file="build-master.xml"/>
    <property file="build.properties" />

	<filelist dir="../src" id="sourceFiles">
		<!-- contrib -->
		<file name="contrib/Tween.js" />
		<!-- our sources -->
		<file name="interfaces.js" />
		<file name="util.js" />
		<file name="ClientMoveable.js" />
		<file name="ClientMotionFactory.js" />
		<file name="ConstraintCollection.js" />
		<file name="ClientAnimatable.js" />
		<file name="ClientKeyframeAnimation.js" />
		<file name="CombinedAnimation.js" />
	</filelist>

	<filelist dir="../src" id="externs">
			<file name="externs.js" />
	</filelist>

	<target name="develop" depends="init">
		<tstamp />
		<concatScripts version="DEVELOPMENT SNAPSHOT (${TODAY})"/>
	</target>

    <target name="develop-min" depends="init">
        <tstamp />
        <compileScripts version="DEVELOPMENT SNAPSHOT (${TODAY})" extension="" level="simple">
        	<args>
        		   <define name="XMOT.version" value="@{version}"/>
        	</args>
        </compileScripts>
    </target>

   <target name="lastTag" depends="init, windowsGit, linuxGit">
        <tstamp />
        <git command="describe">
            <args>
                <arg value="--tags" />
                <arg value="--abbrev=0" />
            </args>
        </git>
        <echo message="${git.output}" />
        <concatScripts version="${git.output}" extension="-${git.output}"/>
        <compileScripts version="${git.output}" extension="-${git.output}-min">
            <args>
                <define name="XMOT.version" value="@{version}"/>
            </args>
        </compileScripts>
    </target>

    <target name="continuous" depends="init, windowsGit, linuxGit">
        <tstamp />
        <git command="log">
            <args>
                <arg value="-1" />
                <arg value="--format=%h / %ci" />
            </args>
        </git>
        <echo message="${git.output}" />
        <concatScripts version="DEVELOPMENT SNAPSHOT / ${git.output}" extension="-${continuous.extension}"/>
        <compileScripts version="DEVELOPMENT SNAPSHOT / ${git.output}" extension="-${continuous.extension}-min">
            <args>
                    <define name="XMOT.version" value="@{version}"/>
            </args>
        </compileScripts>
        <upload extension="-${continuous.extension}"/>
        <upload extension="-${continuous.extension}-min"/>
    </target>

</project>
