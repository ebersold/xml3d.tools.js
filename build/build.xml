<?xml version="1.0" encoding="UTF-8"?>
<!-- ======================================================================
     project    xml3d-motion.js
     description
     Deploy script that prepares a single xml3d.js script file

     Author: Kristian Sons
     ====================================================================== -->
<project name="script-merge" default="develop">
    <description>
           Merge all the single scripts to one global xml3d-motion.js
    </description>

    <import file="build-master.xml"/>
    <property file="build.properties" />

    <filelist dir="../src" id="sourceFiles">
        <file name="interfaces.js" />
        <!-- contrib -->
        <file name="contrib/Tween.js" />
        <!-- our sources -->
        <file name="base/class.js" />
        <file name="base/util.js" />
        <file name="base/math.js" />
        <file name="base/Transformable.js" />
        <file name="base/MotionFactory.js" />
        <file name="base/ClientAnimatable.js" />
        <file name="base/ClientKeyframeAnimation.js" />

        <file name="util/xml3d_datatype_extensions.js" />
        <file name="util/util.js" />
        <file name="util/meshloading.js" />
        <file name="util/nodegetter.js" />
        <file name="util/transformablehelpers.js" />
        <file name="util/graphtraversal.js" />

        <file name="util/attachable.js" />
        <file name="util/creation.js" />
        <file name="util/input.js" />
        <file name="util/geoobject.js" />
        <file name="util/observable.js" />
        <file name="util/eventdispatcher.js" />
        <file name="util/plane.js" />
        <file name="util/transformtracker.js" />
        <file name="util/viewtracker.js" />
        <file name="util/transformsensor.js" />
        <file name="util/map.js" />
        <file name="util/idgenerator.js" />

        <file name="animation/CombinedAnimation.js" />

        <file name="constraint/DefaultConstraint.js" />
        <file name="constraint/ConstraintCollection.js" />
        <file name="constraint/SimpleConstraint.js" />
        <file name="constraint/ProhibitAxisMovementConstraint.js" />
        <file name="constraint/BoxedTranslationConstraint.js" />

        <file name="camera/CameraController.js" />
        <file name="camera/CameraBehavior.js" />
        <file name="camera/ExamineBehavior.js" />
        <file name="camera/MouseController.js" />
        <file name="camera/KeyboardController.js" />
        <file name="camera/TouchController.js" />
        <file name="camera/MouseExamineController.js" />
        <file name="camera/FlyBehavior.js" />
        <file name="camera/MouseKeyboardFlyController.js" />
        <file name="camera/TouchFlyController.js" />
        <file name="camera/ExamineController.js" />
        <file name="camera/CameraAnimationController.js" />

        <file name="gamepad/GamepadEventProvider.js" />

        <file name="xml3doverlay/mirroredwidgettarget.js" />
        <file name="xml3doverlay/mirroredview.js" />
        <file name="xml3doverlay/groupmirror.js" />
        <file name="xml3doverlay/xml3doverlay.js" />

        <file name="interaction/geometry/geometry.js" />
        <file name="interaction/geometry/viewedconstantsizegeometry.js" />
        <file name="interaction/geometry/targetscaledgeometry.js" />
        <file name="interaction/geometry/translategizmo.js" />
        <file name="interaction/geometry/rotategizmo.js" />

        <file name="interaction/behaviors/pdsensor.js" />
        <file name="interaction/behaviors/planesensor.js" />
        <file name="interaction/behaviors/scaler.js" />
        <file name="interaction/behaviors/trackball.js" />
        <file name="interaction/behaviors/rotater.js" />
        <file name="interaction/behaviors/translater.js" />

        <file name="interaction/widgets/widget.js" />
        <file name="interaction/widgets/overlaywidget.js" />
        <file name="interaction/widgets/translategizmo.js" />
        <file name="interaction/widgets/rotategizmo.js" />
    </filelist>

    <filelist dir="../externs" id="externs">
            <file name="externs.js" />
    </filelist>

    <target name="develop" depends="init">
        <tstamp />
        <concatScripts version="DEVELOPMENT SNAPSHOT 0.2.0 (${TODAY})"/>
    </target>

    <target name="develop-min" depends="init">
        <tstamp />
        <compileScripts version="DEVELOPMENT SNAPSHOT (${TODAY})" extension="" level="simple">
            <args>
                   <define name="XMOT.version" value="@{version}"/>
            </args>
        </compileScripts>
    </target>

   <target name="lastTag" depends="init, windowsGit, linuxGit">
        <tstamp />
        <git command="describe">
            <args>
                <arg value="--tags" />
                <arg value="--abbrev=0" />
            </args>
        </git>
        <echo message="${git.output}" />
        <concatScripts version="${git.output}" extension="-${git.output}"/>
        <compileScripts version="${git.output}" extension="-${git.output}-min">
            <args>
                <define name="XMOT.version" value="@{version}"/>
            </args>
        </compileScripts>
    </target>

    <target name="continuous" depends="init, windowsGit, linuxGit">
        <tstamp />
        <git command="log">
            <args>
                <arg value="-1" />
                <arg value="--format=%h / %ci" />
            </args>
        </git>
        <echo message="${git.output}" />
        <concatScripts version="DEVELOPMENT SNAPSHOT / ${git.output}" extension="-${continuous.extension}"/>
        <compileScripts version="DEVELOPMENT SNAPSHOT / ${git.output}" extension="-${continuous.extension}-min">
            <args>
                    <define name="XMOT.version" value="@{version}"/>
            </args>
        </compileScripts>
        <upload extension="-${continuous.extension}"/>
        <upload extension="-${continuous.extension}-min"/>
    </target>

</project>
