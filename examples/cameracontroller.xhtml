<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd" >
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:webgl="http://www.xml3d.org/2009/xml3d/webgl" xmlns:x3d="http://www.web3d.org/specifications/x3d-namespace">
	<head>
		<title>CameraController</title>

		<link rel="stylesheet" type="text/css" media="all" href="style/default.css"/>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<script type="text/javascript" src="page.js"></script>

		<script type="text/javascript" src="external/xml3d.js"></script>
		<script src="../build/output/xml3d-toolkit.js" type="text/javascript"/>
	</head>
	<body onload="initCamera()">
		<div id="overall">
		<div id="content">
		<h1>CameraController</h1>
		<xml3d id="scene" xmlns="http://www.xml3d.org/2009/xml3d" style="width: 512px; height: 512px; background-color:rgb(14,56,102);">
			<defs>
				<transform id="t_TRANS"/>
				<shader id="s_d1e23" script="urn:xml3d:shader:phong">
					<float3 name="diffuseColor">0 0 0</float3>
					<float3 name="specularColor">0 0 0</float3>
					<float3 name="emissiveColor">1 1 0</float3>
					<float name="transparency">0</float>
					<float name="shininess">60</float>
					<float name="ambientIntensity">0.2</float>
				</shader>
				<data id="animation">
					<float name="key">0 0.08 0.16 0.24 0.32 0.4 0.48 0.56 0.64 0.72 0.8 0.88 0.96</float>
					<float3 name="position">0 0 0 -2 0 0 0 0 0 2 0 0 0 0 0 0 -2 0 0 0 0 0 2 0 0 0 0 0 0 -2 0 0 0 0 0 2 0 0 0</float3>
					<float4 name="orientation">1 0 0 0 0.7073882818222046 0.7068251967430115 0 0 0.0007963267271406949 0.9999997019767761 0 0 -0.7062616348266602 0.7079508900642395 0 0 -0.9999987483024597 0.0015926528722047806 0 0 1 0 0 0 0.7073882818222046 0 0.7068251967430115 0 0.0007963267271406949 0 0.9999997019767761 0 -0.7062616348266602 0 0.7079508900642395 0 -0.9999987483024597 0 0.0015926528722047806 0 1 0 0 0 0.7073882818222046 0 0 0.7068251967430115 0.0007963267271406949 0 0 0.9999997019767761</float4>
				</data>
			</defs>
			<group id="node-camera_player">
				<view position="0 0 10" fieldOfView="0.77699953" id="camera_player-camera"/>
			</group>
			<group id="root">
				<group>
					<group id="shape_d1e22" shader="#s_d1e23" transform="#t_TRANS">
						<mesh type="triangles" id="m_d1e25">
							<int name="index">0 1 2 2 3 0 4 7 5 5 7 6 8 9 10 10 11 8 12 14 13 14 12 15 16 17 18 18 19 16 20 22 21 22 20 23 </int>
							<float3 name="position">-1.0 -1.0 -1.0 -1.0 1.0 -1.0 1.0 1.0 -1.0 1.0 -1.0 -1.0 -1.0 -1.0 1.0 -1.0 1.0 1.0 1.0 1.0 1.0 1.0 -1.0 1.0 -1.0 -1.0 -1.0 -1.0 -1.0 1.0 -1.0 1.0 1.0 -1.0 1.0 -1.0 1.0 -1.0 -1.0 1.0 -1.0 1.0 1.0 1.0 1.0 1.0 1.0 -1.0 -1.0 1.0 -1.0 -1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 -1.0 -1.0 -1.0 -1.0 -1.0 -1.0 1.0 1.0 -1.0 1.0 1.0 -1.0 -1.0 </float3>
							<float3 name="normal">0.0 0.0 -1.0 0.0 0.0 -1.0 0.0 0.0 -1.0 0.0 0.0 -1.0 0.0 0.0 1.0 0.0 0.0 1.0 0.0 0.0 1.0 0.0 0.0 1.0 -1.0 0.0 0.0 -1.0 0.0 0.0 -1.0 0.0 0.0 -1.0 0.0 0.0 1.0 0.0 0.0 1.0 0.0 0.0 1.0 0.0 0.0 1.0 0.0 0.0 0.0 1.0 0.0 0.0 1.0 0.0 0.0 1.0 0.0 0.0 1.0 0.0 0.0 -1.0 0.0 0.0 -1.0 0.0 0.0 -1.0 0.0 0.0 -1.0 0.0 </float3>
							<float2 name="texcoord">1.0 0.0 1.0 1.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 1.0 1.0 1.0 0.0 0.0 0.0 1.0 0.0 1.0 1.0 0.0 1.0 1.0 0.0 0.0 0.0 0.0 1.0 1.0 1.0 0.0 1.0 0.0 0.0 1.0 0.0 1.0 1.0 0.0 0.0 0.0 1.0 1.0 1.0 1.0 0.0 </float2>
						</mesh>
					</group>
				</group>
			</group>
		</xml3d>
		<div>
			<div>
				<button onclick="animate()">Animate for 100 seconds</button>
				<button id="toggleCtrl" onclick="toggleController()">Deactivate Controller</button>
			</div>
			<br/>
			<h2>Controls:</h2>
			Rotation: Right Mousebutton down and move OR arrow keys<br/>
			Movement: WASD + page Up / Down<br/>
			Reset: R<br/>
		</div>

		<script type="text/javascript">
			var movObjects = {};
			var factory = XML3D.tools.MotionFactory;
			var constraint = new XML3D.tools.SimpleConstraint(true, true, true);
			var controllerActive = true;

			function animate(){
				var aobj = movObjects.cube;
				if(!aobj) {
					aobj = movObjects.cube = createAnimatable();
				}
				aobj.startAnimation("a1", {loop:2});
			}

			function initCamera(){
				var rotatearoundpoint = false;
				var initialRotation = new XML3DRotation(new XML3DVec3(0, 0, 0), 0);
				movObjects.cam = new XML3D.tools.CameraController("node-camera_player", "scene", initialRotation, "left", rotatearoundpoint);
				createPois();
			}

			function createAnimatable() {
				var c = factory.createAnimatable(document.getElementById("shape_d1e22"), constraint);
				var a1 = factory.createKeyframeAnimation("a1", document.getElementById("animation"), {duration: 100000});
				c.addAnimation(a1);
				return c;
			}

			function createPois(){
				var cam = movObjects.cam;
				var i = 0;
				for(i=0; i!=5; i++)
					cam.addPointOfInterest( new XML3DVec3(i, i, i), new XML3DRotation(new XML3DVec3(i, i, i), i) );
				cam.addPointOfInterest( new XML3DVec3(i, i, i), new XML3DRotation(new XML3DVec3(i, i, i), i) );
			}

			function toggleController(){
				if(controllerActive)
				{
					movObjects.cam.deactivate();
					$("#toggleCtrl").html("Activate Controller");
				}
				else
				{
					movObjects.cam.activate();
					$("#toggleCtrl").html("Deactivate Controller");
				}

				controllerActive = !controllerActive;
			}
		</script>
		</div>
		</div>
	</body>
</html>
